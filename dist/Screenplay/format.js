window.storyFormat({"name":"Screenplay","version":"0.1","description":"A story format that resembles a screenplay. Uses tags to show specific run-throughs which actors can more easily digest. Icon by DARAYANI from <a href=\"https://thenounproject.com/browse/icons/term/screenplay/\">Noun Project</a> (CC BY 3.0)","author":"Joe Bain","image":"icon.svg","url":"http://hairyheart.games","license":"ZLib/Libpng","proofing":true,"source":"<!DOCTYPE html>\n<html>\n<head>\n<title>{{STORY_NAME}}\n</title>\n<meta charset=\"utf-8\">\n<style>\nbody\n{\n\tfont: 10pt Cousine, monospace;\n\tmargin: 2em auto;\n\twidth: 600px;\n}\n\nh1\n{\n\tfont-size: 14pt;\n\ttext-align: center;\n\tmargin-bottom: 1em;\n}\n\nh2\n{\n\tfont-size: 12pt;\n\ttext-align: center;\n\tmargin-bottom: 1.5em;\n}\n\ntw-storydata\n{\n\tdisplay: block !important;\n}\n\ntw-passagedata\n{\n\tdisplay: block !important;\n\tline-height: 200%;\n\tmargin-bottom: 2em;\n\twhite-space: pre-wrap;\n\tposition: relative;\n}\n\ntw-passagedata + tw-passagedata\n{\n\tborder-top: 1pt dashed black;\n\t/*padding-top: 2em;*/\n}\n\n/*\ntw-passagedata:before\n{\n\tcontent: attr(name);\n\tdisplay: block;\n\tfont-weight: bold;\n}\n*/\nspan.character-name {\n\tdisplay: block;\n    margin-left: 200px;\n\ttext-transform: uppercase;\n}\nspan.character-line {\n\tdisplay: block;\n    margin-left: 100px;\n}\n.hidden {\n\tdisplay: none !important;\n}\n.alternate {\n\tcolor: red;\n}\nspan.sequence-id {\n\tdisplay: block;\n    position: absolute;\n    left: -100px;\n    font-size: 14pt;\n}\n</style>\n<script>\nvar tag;\nvar originalPassages = [];\nvar containerEl;\nvar tagLabelEl;\n\nconst charNameRE = /(\\w*):\\s*(.*)\\n/g;\nconst choiceRE = /\\[\\[.*\\]\\]/g;\nconst dupeNewlineRE = /\\n+/g;\nfunction processPassage(passage, p, tag) {\n\tvar html = passage.innerHTML;\n\thtml = html.replaceAll(charNameRE, \"<span class='character-name'>$1</span><span class='character-line'>$2</span>\");\n\thtml = html.replaceAll(choiceRE, \"\");\n\thtml = html.replaceAll(dupeNewlineRE, \"\\n\");\n\thtml = \"<span class='sequence-id'>#\" + tag + p + \"</span>\" + html;\n\tvar processedPassage = passage.cloneNode(true);\n\tprocessedPassage.innerHTML = html;\n\treturn processedPassage;\n}\n\nfunction showRun(tag, saveOriginals) {\n\ttagLabelEl.innerText = \"Run \" + tag;\n\n\tvar passages = document.getElementsByTagName(\"tw-passagedata\");\n\tfor (var p = passages.length-1; p >= 0 ; p--) {\n\t\tvar passage = passages[p];\n\t\tif (saveOriginals) {\n\t\t\toriginalPassages[p] = passage.cloneNode(true);\n\t\t}\n\t\tpassage.remove();\n\t}\n\tvar seq = 1;\n\tfor (var p = 0 ; p < originalPassages.length ; p++) {\n\t\tvar passage = originalPassages[p];\n\t\tvar tags = passage.getAttribute(\"tags\");\n\t\tvar processedPassage = processPassage(passage, seq, tag);\n\t\tif (tags.split(' ').indexOf(tag) >= 0) {\n\t\t\tseq++;\n\t\t\tcontainerEl.appendChild(processedPassage);\n\t\t}\n\t}\n}\n\nfunction onTagSelectChange(event) {\n\ttag = event.target.value;\n\tshowRun(tag);\n}\n\nwindow.onload = function() {\n\ttag = \"A\";\n\tcontainerEl = document.getElementsByTagName(\"tw-storydata\")[0];\n\ttagLabelEl = document.createElement(\"h2\");\n\tcontainerEl.appendChild(tagLabelEl);\n\n\tshowRun(tag, true);\n\n\tvar selectControl = document.getElementById(\"tag-select\");\n\tselectControl.addEventListener('change', onTagSelectChange);\n\n}\n</script>\n</head>\n\n<body>\n\n<label for=\"tag-select\">Choose a run:</label>\n<select name=\"runs\" id=\"tag-select\">\n\t<option value=\"A\">A</option>\n\t<option value=\"B\">B</option>\n</select>\n\n<h1>{{STORY_NAME}}\n</h1>\n{{STORY_DATA}}\n\n\n</body>\n</html>\n"});